"0","year <- 2008:2017"
"0","for (i in year) {"
"0","  if (i == 2008){"
"0","    crimes_year <- read_xls(""2008.xls"", range = ""A5:E56"", col_names = FALSE)"
"0","    crimes_year <- crimes_year %>%"
"0","      select(...1, ...3, ...5)"
"0","    names(crimes_year)[1:3] <- c(""states"",""2008pop"",""2008crimes"")"
"0","  }"
"0","  else{"
"0","    later <- read_xls(paste(i,"".xls"", sep = """"), range = ""A5:E56"", col_names = FALSE)"
"0","    later <- later %>%"
"0","      select(...1, ...3, ...5)"
"0","    names(later)[1:3] <- c(""states"",paste(i, ""pop"", sep = """"),paste(i, ""crimes"", sep = """"))"
"0","    crimes_year <- left_join(crimes_year, later, by = ""states"")"
"0","  }"
"0","}"
"0","for (i in 1:10) {"
"0","    crimes_year[21+i] <- (crimes_year[1+2*i]/crimes_year[2*i])*100000"
"0","    names(crimes_year)[21+i] <- paste(i+2007)"
"0","}"
"0","crimes_year <- crimes_year %>%"
"0","  select(1, 22:31) "
"0","crimes_year <- gather(crimes_year, key = ""year"", value = ""number"", -states)"
"0","crimes_year <- filter(crimes_year, !is.na(number))"
"0","geometry <- select(data, NAME, geometry)"
"0","geometry <- left_join(geometry, crimes_year, by = c(""NAME"" = ""states""))"
"0","geometry$year <- as.numeric(geometry$year)"
"0",""
"0","class(geometry$year)"
"1","[1]"
"1"," ""numeric"""
"1","
"
"0","plot_maker <- function(x) {"
"0","geometry %>%"
"0","  filter(year == x) %>%"
"0","  ggplot() +"
"0","  geom_sf(aes(fill = number)) +"
"0","    theme_void() +"
"0","    scale_fill_distiller(palette = ""Spectral"", "
"0","                         name = """", "
"0","                         breaks = c(2.5,5,7.5),"
"0","                         limits = c(0, 10)"
"0","                         )+"
"0","    theme("
"0","      legend.position = ""top"","
"0","      plot.title = element_text(hjust = 0.5, face = ""bold""),"
"0","      plot.subtitle = element_text(hjust = 0.5, face = ""italic"")"
"0","    )+"
"0","    labs("
"0","      title = ""HATE CRIMES IN THE U.S.A"","
"0","      caption = ""Source: FBI"","
"0","      subtitle = paste(""Average hate crimes per 100,000 residents "", x)"
"0","    )"
"0","  ggsave(str_c(""plot"", x, "".png""))"
"0","}"
"0","#map(2008:2017, plot_maker)"
